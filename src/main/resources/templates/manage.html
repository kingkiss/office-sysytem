
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OFFICE 云物品</title>

    <link rel="stylesheet" href="my/bootstrap.min.css">
    <link rel="stylesheet" href="my/mystyle.css">
    <script src="my/jquery-3.1.1.min.js"></script>
    <script src="my/vue.js"></script>
    <script src="my/bootstrap.min.js"></script>
    <script src="my/axios.min.js"></script>
    <!---<link rel="shortcut icon" href="pic/officeicon.ico">  -->
</head>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <!--<div class="row">
        <div class="col-md-10">
            <p class="navbar-text" style="font-family: Microsoft YaHei;font-size: 18px">OFFICE 云管理</p>
        </div>
        <div id="user" class="col-md-2" style="padding-top: 4.5px">
            <div class="btn-group">
                <img src="pic/user_icon.png" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <button class="navbar-text" style="font-family: Microsoft YaHei;font-size: 15px;background-color: #EC3851">{{ user_truename }}</button>
                <ul class="dropdown-menu">
                    <li><img src="pic/user2_icon.png"></li>
                    <li class="dropdown-header" style="color: #8a8a8a">{{ user_truename }}</li>
                    <li class="dropdown-header" style="color: #8a8a8a">{{ user_name }}</li>
                    <li role="separator" class="divider"></li>
                    <li><a data-toggle="modal" data-target="#userInfo">个人详情</a></li>
                    <li><a href="http://localhost:8080/loginout">注销</a></li>
                </ul>
            </div>

        </div>
    </div>-->

    <div class="container-fluid" id="user">
        <div class="navbar-header">
            <a class="navbar-brand" href="manage_officelist" style="font-family: Microsoft YaHei;font-size: 20px;color: #fff">OFFICE 云管理</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right" style="margin-right: 50px;">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"
                       style="font-family: Microsoft YaHei;font-size: 20px;color: #fff">{{ user_truename }}</span></a>
                    <ul class="dropdown-menu">
                        <li><img src="pic/user2_icon.png"></li>
                        <li class="dropdown-header" style="color: #8a8a8a">{{ user_truename }}</li>
                        <li class="dropdown-header" style="color: #8a8a8a">{{ user_name }}</li>
                        <li role="separator" class="divider"></li>
                        <li><a data-toggle="modal" data-target="#userInfo">个人详情</a></li>
                        <li><a href="http://localhost:8080/loginout">注销</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<body style="padding-top: 51px;">

<div class="left-nav">
    <div class="list-group" id="fun_show_left">
        <a href="manage_officelist" th:class="${isOfficeList}?'list-group-item list-item-active':'list-group-item'" >物品申请</a>
        <a href="manage_officeInfo" th:class="${isOfficeInfo}?'list-group-item list-item-active':'list-group-item'" v-show="userdata.user_authority >= 3">物品管理</a>
        <a href="manage_officeType" th:class="${isOfficeType}?'list-group-item list-item-active':'list-group-item'" v-show="userdata.user_authority >= 3" >物品类型</a>
        <a href="manage_userInfo" th:class="${isUserInfo}?'list-group-item list-item-active':'list-group-item'" v-show="userdata.user_authority >= 7">用户管理</a>
        <a href="manage_applyCheck" th:class="${isApplyCheck}?'list-group-item list-item-active':'list-group-item'" v-show="userdata.user_authority >= 3">申请审核</a>
        <a href="manage_applyList" th:class="${isApplyList}?'list-group-item list-item-active':'list-group-item'">申请记录</a>
        <a href="manage_borrowList" th:class="${isBorrowList}?'list-group-item list-item-active':'list-group-item'">借入/归还记录</a>
        <!--<a href="manage_returnList" th:class="${isReturnList}?'list-group-item list-item-active':'list-group-item'">归还记录</a>-->
        <!--<a href="#" class="list-group-item" v-show="userdata.user_authority >= 3">购入记录</a>-->
        <a href="manage_useData" th:class="${isUseData}?'list-group-item list-item-active':'list-group-item'" v-show="userdata.user_authority >= 3">使用统计</a>
    </div>
</div>

<div class="rigth-nav">
    <div class="container" style="margin-left: 0;width: 85%;">
        <!--用户管理模块（用户查询、修改、删除、添加）-->
        <div th:include="manage_userInfo :: m_userInfo" th:if="${isUserInfo}"></div>
        <!--物品申请模块（物品查询、借入）-->
        <div th:include="manage_officelist :: m_officelist" th:if="${isOfficeList}"></div>
        <!--物品管理模块（物品增删改查） -->
        <div th:include="manage_officeInfo :: m_officeInfo" th:if="${isOfficeInfo}"></div>
        <!--物品类型管理（类型增删改查）-->
        <div th:include="manage_officeType :: m_officeType" th:if="${isOfficeType}"></div>
        <!--申请审核模块（申请的审批）-->
        <div th:include="manage_applyCheck :: m_applyCheck" th:if="${isApplyCheck}"></div>
        <!--申请记录模块（申请记录查看，权限大于3可以搜索用户申请记录）-->
        <div th:include="manage_applyList :: m_applyList" th:if="${isApplyList}"></div>
        <!--借入记录模块（借入记录查看）-->
        <div th:include="manage_borrowList :: m_borrowList" th:if="${isBorrowList}"></div>
        <!--归还记录模块-->
        <div th:include="manage_returnList :: m_returnList" th:if="${isReturnList}"></div>
        <!--使用统计模块-->
        <div th:include="manage_useData :: m_useData" th:if="${isUseData}"></div>

    </div>
</div>

<!-- 个人信息Modal框   用户个人信息查看和修改-->
<div th:include="modal :: userModal"></div>
<!-- 添加用户用modal框 -->
<div th:include="modal :: addUserModal"></div>
<!-- 用户信息修改用modal框 -->
<div th:include="modal :: userChangeModal"></div>
<!--申请物品modal框-->
<div th:include="modal :: applyModal"></div>
<!--修改物品modal框-->
<div th:include="modal :: changeProductModal"></div>
<!--增加物品modal框-->
<div th:include="modal :: addProductModal"></div>
<!--删除物品modal框-->
<div th:include="modal :: deleteProductModal"></div>
<!--增加物品类型modal框-->
<div th:include="modal :: addTypeModal"></div>
<!--删除物品类型modal框-->
<div th:include="modal :: deleteTypeModal"></div>
<!--申请审核确认modal框-->
<div th:include="modal :: applyCheckModal"></div>
<!--删除申请记录确认modal框-->
<div th:include="modal :: daleteApplyModal"></div>

<!--借入记录归还、挂失、删除modal框-->
<div th:include="modal :: borrowModal"></div>

</body>

<!--通用数据流-->
<script src="my/public_data.js"></script>
<!--用户管理数据处理-->
<script src="my/manage_userInfo.js"></script>
<!--物品申请模块处理-->
<script src="my/manage_officelist.js"></script>
<!--物品管理模块处理-->
<script src="my/manage_officeInfo.js"></script>
<!--物品类型模块处理-->
<script src="my/manage_officeType.js"></script>
<!--申请审核模块处理-->
<script src="my/manage_applyCheck.js"></script>


<script>
/*    $('.list-group-item').click(function () {
        $(this).siblings('.list-group-item').removeClass('list-item-active');
        $(this).addClass('list-item-active');
    });*/

/*借入/归还记录模块数据处理（m_returnList）*/
    var m_borrowList = new Vue({
        el:'#allBorrowList',
        data:{
            message,
            userdata,
            tempBorrowListInfo,
            searchBorrow:'',
            borrowLists:[],
            pagination:{},
        },
        mounted:function () {
            this.getAllBorrowList(1)

        },
        methods:{
            getAllBorrowList:function (start) {
                var self = this;
                var url = '/allBorrowList?start='+start;
                console.log(userdata);
                axios.get(url).then(function(response){
                    var result = response.data;
                    self.borrowLists = result.AllBorrowLists;
                    self.pagination = result.page;

                })
            },
            jumpByNumber:function (start) {
                var self = this;
                if( start != self.pagination.pageNum ){
                    self.getAllBorrowList(start);
                };
            },
            jumpPage:function (page) {
                var self = this;
                if( page == 'pre' && self.pagination.hasPreviousPage ){
                    self.getAllBorrowList( self.pagination.prePage );
                }else if( page == 'next' && self.pagination.hasNextPage ){
                    self.getAllBorrowList( self.pagination.nextPage );
                };
            },
            searchBorrowList:function () {
                var self = this;
                var url = "/SearchBorrowList";
                axios.get(url,{params:{borrowList:self.searchBorrow}}).then(function(response){
                    var result = response.data;
                    self.borrowLists = result.SearchBorrowLists;
                    self.pagination = result.page;
                })
            },
            addBorrowinfoToTemp:function (borrow) {
                var self = this;
                self.tempBorrowListInfo.borrowinfo_id = borrow.borrowinfo_id;
                self.tempBorrowListInfo.borrowinfo_user_id = borrow.borrowinfo_user_id;
                self.tempBorrowListInfo.borrowinfo_user_truename = borrow.borrowinfo_user_truename;
                self.tempBorrowListInfo.borrowinfo_product_id = borrow.borrowinfo_product_id;
                self.tempBorrowListInfo.borrowinfo_num = borrow.borrowinfo_num;
                self.tempBorrowListInfo.borrowinfo_product_name = borrow.borrowinfo_product_name;
                self.tempBorrowListInfo.borrowinfo_product_price = borrow.borrowinfo_product_price;
                self.tempBorrowListInfo.borrowinfo_time = borrow.borrowinfo_time;
            },
        }
    });
/*归还确认modal框数据处理*/
var returnModal = new Vue({
    el:'#borrowReturnModal',
    data:{
        message,
        userdata,
        tempBorrowListInfo,
    },
    methods:{
        clearTemp:function () {
            var self = this;
            self.tempBorrowListInfo.borrowinfo_id = '';
            self.tempBorrowListInfo.borrowinfo_user_id = '';
            self.tempBorrowListInfo.borrowinfo_user_truename = '';
            self.tempBorrowListInfo.borrowinfo_product_id = '';
            self.tempBorrowListInfo.borrowinfo_product_name = '';
            self.tempBorrowListInfo.borrowinfo_product_price = '';
            self.tempBorrowListInfo.borrowinfo_num = '';
            self.tempBorrowListInfo.borrowinfo_time = '';
            self.tempBorrowListInfo.borrowinfo_return = 0;
            self.tempBorrowListInfo.borrowinfo_return_num = 0;
            self.tempBorrowListInfo.borrowinfo_missprice = 0;

        }
    },
    computed:{
        missPrice:function () {
            var self = this;
            self.tempBorrowListInfo.borrowinfo_missprice = (self.tempBorrowListInfo.borrowinfo_num*self.tempBorrowListInfo.borrowinfo_product_price)
                -(self.tempBorrowListInfo.borrowinfo_return_num*self.tempBorrowListInfo.borrowinfo_product_price);
            /*if(self.tempBorrowListInfo.borrowinfo_missprice<0){
                self.tempBorrowListInfo.borrowinfo_missprice = self.tempBorrowListInfo.borrowinfo_num*self.tempBorrowListInfo.borrowinfo_product_price;
                return self.tempBorrowListInfo.borrowinfo_missprice
            }*/
            return self.tempBorrowListInfo.borrowinfo_missprice
        },
    }
});

/*挂失确认modal框数据处理*/
var missModal = new Vue({
    el:'#borrowMissModal',
    data:{
        message,
        userdata,
        tempBorrowListInfo,
    },
    methods:{
        clearTemp:function () {
            var self = this;
            self.tempBorrowListInfo.borrowinfo_id = '';
            self.tempBorrowListInfo.borrowinfo_user_id = '';
            self.tempBorrowListInfo.borrowinfo_user_truename = '';
            self.tempBorrowListInfo.borrowinfo_product_id = '';
            self.tempBorrowListInfo.borrowinfo_product_name = '';
            self.tempBorrowListInfo.borrowinfo_product_price = '';
            self.tempBorrowListInfo.borrowinfo_num = '';
            self.tempBorrowListInfo.borrowinfo_time = '';
            self.tempBorrowListInfo.borrowinfo_return = 0;
            self.tempBorrowListInfo.borrowinfo_return_num = 0;
            self.tempBorrowListInfo.borrowinfo_missprice = 0;
        }
    },
});

/*删除确认modal框数据处理*/
var deleteBorrowModal = new Vue({
    el:'#borrowDeleteModal',
    data:{
        message,
        userdata,
        tempBorrowListInfo,
    },
    methods:{
        clearTemp:function () {
            var self = this;
            self.tempBorrowListInfo.borrowinfo_id = '';
            self.tempBorrowListInfo.borrowinfo_user_id = '';
            self.tempBorrowListInfo.borrowinfo_user_truename = '';
            self.tempBorrowListInfo.borrowinfo_product_id = '';
            self.tempBorrowListInfo.borrowinfo_product_name = '';
            self.tempBorrowListInfo.borrowinfo_product_price = '';
            self.tempBorrowListInfo.borrowinfo_num = '';
            self.tempBorrowListInfo.borrowinfo_time = '';
            self.tempBorrowListInfo.borrowinfo_return = 0;
            self.tempBorrowListInfo.borrowinfo_return_num = 0;
            self.tempBorrowListInfo.borrowinfo_missprice = 0;
        }
    },
});

</script>

</html>