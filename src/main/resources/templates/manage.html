
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OFFICE 云物品</title>

    <link rel="stylesheet" href="my/bootstrap.min.css">
    <link rel="stylesheet" href="my/mystyle.css">
    <script src="my/jquery-3.1.1.min.js"></script>
    <script src="my/vue.js"></script>
    <script src="my/bootstrap.min.js"></script>
    <script src="my/axios.min.js"></script>
    <!---<link rel="shortcut icon" href="pic/officeicon.ico">  -->
</head>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <!--<div class="row">
        <div class="col-md-10">
            <p class="navbar-text" style="font-family: Microsoft YaHei;font-size: 18px">OFFICE 云管理</p>
        </div>
        <div id="user" class="col-md-2" style="padding-top: 4.5px">
            <div class="btn-group">
                <img src="pic/user_icon.png" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <button class="navbar-text" style="font-family: Microsoft YaHei;font-size: 15px;background-color: #EC3851">{{ user_truename }}</button>
                <ul class="dropdown-menu">
                    <li><img src="pic/user2_icon.png"></li>
                    <li class="dropdown-header" style="color: #8a8a8a">{{ user_truename }}</li>
                    <li class="dropdown-header" style="color: #8a8a8a">{{ user_name }}</li>
                    <li role="separator" class="divider"></li>
                    <li><a data-toggle="modal" data-target="#userInfo">个人详情</a></li>
                    <li><a href="http://localhost:8080/loginout">注销</a></li>
                </ul>
            </div>

        </div>
    </div>-->

    <div class="container-fluid" id="user">
        <div class="navbar-header">
            <a class="navbar-brand" href="manage_officelist" style="font-family: Microsoft YaHei;font-size: 20px;color: #fff">OFFICE 云管理</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right" style="margin-right: 50px;">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"
                       style="font-family: Microsoft YaHei;font-size: 20px;color: #fff">{{ user_truename }}</span></a>
                    <ul class="dropdown-menu">
                        <li><img src="pic/user2_icon.png"></li>
                        <li class="dropdown-header" style="color: #8a8a8a">{{ user_truename }}</li>
                        <li class="dropdown-header" style="color: #8a8a8a">{{ user_name }}</li>
                        <li role="separator" class="divider"></li>
                        <li><a data-toggle="modal" data-target="#userInfo">个人详情</a></li>
                        <li><a href="http://localhost:8080/loginout">注销</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<body style="padding-top: 51px;">

<div class="left-nav">
    <div class="list-group" id="fun_show_left">
        <a href="manage_officelist" th:class="${isOfficeList}?'list-group-item list-item-active':'list-group-item'">物品申请</a>
        <a href="manage_officeInfo" th:class="${isOfficeInfo}?'list-group-item list-item-active':'list-group-item'" v-show="userdata.user_authority >= 3">物品管理</a>
        <a href="#" class="list-group-item" v-show="userdata.user_authority >= 3">物品类型</a>
        <a href="manage_userInfo" th:class="${isUserInfo}?'list-group-item list-item-active':'list-group-item'" v-show="userdata.user_authority >= 7">用户管理</a>
        <a href="#" class="list-group-item" v-show="userdata.user_authority >= 3">申请审核</a>
        <a href="#" class="list-group-item">申请记录</a>
        <a href="#" class="list-group-item">借入记录</a>
        <a href="#" class="list-group-item">归还记录</a>
        <a href="#" class="list-group-item" v-show="userdata.user_authority >= 3">使用统计</a>
        <a href="#" class="list-group-item" v-show="userdata.user_authority >= 7">系统管理</a>
    </div>
</div>

<div class="rigth-nav">
    <div class="container" style="margin-left: 0;width: 85%;">
        <!--用户管理模块（用户查询、修改、删除、添加）-->
        <div th:include="manage_userInfo :: m_userInfo" th:if="${isUserInfo}"></div>
        <!--物品申请模块（物品查询、借入）-->
        <div th:include="manage_officelist :: m_officelist" th:if="${isOfficeList}"></div>
        <!--物品管理模块（物品增删改查） -->
        <div th:include="manage_officeInfo :: m_officeInfo" th:if="${isOfficeInfo}"></div>
    </div>
</div>

<!-- 个人信息Modal框   用户个人信息查看和修改-->
<div th:include="modal :: userModal"></div>

<!-- 添加用户用modal框 -->
<div th:include="modal :: addUserModal"></div>

<!-- 用户信息修改用modal框 -->
<div th:include="modal :: userChangeModal"></div>

<!--申请物品modal框-->
<div th:include="modal :: applyModal"></div>

<!--修改物品modal框-->
<div th:include="modal :: changeProductModal"></div>

<!--增加物品modal框-->
<div th:include="modal :: addProductModal"></div>

<!--删除物品modal框-->
<div th:include="modal :: deleteProductModal"></div>


</body>
<script src="my/public_data.js"></script>
<script src="my/manage_userInfo.js"></script>
<script src="my/manage_officelist.js"></script>
<script>
/*    $('.list-group-item').click(function () {
        $(this).siblings('.list-group-item').removeClass('list-item-active');
        $(this).addClass('list-item-active');
    });*/

/*m_officeInfo物品管理模块数据处理*/
    var m_officeInfo = new Vue({
        el:'#allProduct',
        data:{
            message,
            userdata,
            tempProductInfo,
            searchProduct:'',
            products:[],
            pagination:{},
        },
        mounted:function(){
            this.productList(1);
        },
        methods:{
            productList:function (start) {
                var url = "/allProduct";
                var self = this;
                axios.get(url,{params:{start:start}}).then(function(response){
                    var result = response.data;
                    self.products = result.AllProducts;
                    self.pagination = result.page;
                })
            },
            jumpByNumber:function (start) {
                var self = this;
                if( start != self.pagination.pageNum ){
                    self.productList(start);
                };
            },
            jumpPage:function (page) {
                var self = this;
                if( page == 'pre' && self.pagination.hasPreviousPage ){
                    self.productList( self.pagination.prePage );
                }else if( page == 'next' && self.pagination.hasNextPage ){
                    self.productList( self.pagination.nextPage );
                };
            },
            searchProductList:function () {
                var self = this;
                var url = "/SearchProduct";
                axios.get(url,{params:{product:self.searchProduct}}).then(function(response){
                    var result = response.data;
                    self.products = result.SearchProduct;
                    self.pagination = result.page;
                })
            },
            /*添加数据到申请物品暂存*/
            addTempProduct: function (product) {
                var self = this;
                self.tempProductInfo.product_name = product.product_name;
                self.tempProductInfo.product_num = product.product_num;
                self.tempProductInfo.product_price = product.product_price;
                self.tempProductInfo.product_type = product.product_type;
                self.tempProductInfo.product_id = product.id;
            },
            /*删除物品modal框*/
            deleteProductModal:function (product) {
                var self = this;
                self.tempProductInfo.product_name = product.product_name;
                self.tempProductInfo.product_num = product.product_num;
                self.tempProductInfo.product_price = product.product_price;
                self.tempProductInfo.product_type = product.product_type;
                self.tempProductInfo.product_id = product.id;
            },
        }
    });

    /*修改物品modal框数据处理*/
    var m_changeProduct = new Vue({
        el:'#changeProduct',
        data:{
            message,
            userdata,
            tempProductInfo,
            Types:[],
        },
        mounted:function(){
            this.getType();
        },
        methods: {
            getType:function () {
                var self = this;
                var url = '/allType';
                axios.get(url).then(function (response) {
                    var result = response.data;
                    self.Types = result.AllType;
                })
            },
            clearTemp:function () {
                self.tempProductInfo.product_name = '';
                self.tempProductInfo.product_num = 0;
                self.tempProductInfo.product_price = 0;
                self.tempProductInfo.product_type = '';
                self.tempProductInfo.product_id = '';
            }
        }
    });

    /*添加物品modal框数据处理*/
    var m_addProduct = new Vue({
       el:'#addProduct',
       data:{
           message,
           tempProductInfo,
           Types:[],
       },
        mounted:function(){
          this.getType();
        },
        methods:{
            clearTemp:function () {
                self.tempProductInfo.product_name = '';
                self.tempProductInfo.product_num = 0;
                self.tempProductInfo.product_price = 0;
                self.tempProductInfo.product_type = '';
                self.tempProductInfo.product_id = '';
            },
            getType:function () {
                var self = this;
                var url = '/allType';
                axios.get(url).then(function (response) {
                    var result = response.data;
                    self.Types = result.AllType;
                })
            },
            addNewProduct:function () {
                var self = this;
                var url = '/addProduct';
                var param = {
                    product_name:self.tempProductInfo.product_name,
                    product_num:self.tempProductInfo.product_num,
                    product_price:self.tempProductInfo.product_price,
                    product_type:self.tempProductInfo.product_type,
                };
                if( tempProductInfo.product_name!='' && tempProductInfo.product_type!=''){
                    console.log("非空测试");
                    axios.post(url,param).then(function (response) {
                        var result = response.data;
                        self.message.info = result.info;
                        if( result.result ){
                            console.log(result);
                            $('#addProductS').removeClass('hide').addClass('in')
                            setTimeout(function(){$('#addProductS').removeClass('in').addClass('hide');$('#addProduct').modal('toggle');},1500);
                        }else{
                            $('#addProductF').removeClass('hide').addClass('in')
                            setTimeout(function(){$('#addProductF').removeClass('in').addClass('hide')},3000);
                        }
                    });
                }else {
                    self.message.info = "名称或类型不能为空";
                    $('#addProductF').removeClass('hide').addClass('in')
                    setTimeout(function(){$('#addProductF').removeClass('in').addClass('hide')},3000);
                }
            },
        }
    });

    /*删除物品确认modal框*/
    var m_deleteProduct = new Vue({
        el:'#deleteProductModal',
        data:{
            message,
            tempProductInfo,
        },
        methods:{
            clearTemp:function () {
                self.tempProductInfo.product_name = '';
                self.tempProductInfo.product_num = 0;
                self.tempProductInfo.product_price = 0;
                self.tempProductInfo.product_type = '';
                self.tempProductInfo.product_id = '';
            },
            /*提交删除*/
            deleteProductS:function () {
                var self = this;
                var url = "/deleteProduct/"+tempProductInfo.product_id;
                axios.delete(url).then(function(response) {
                    var result = response.data;
                    self.message.info = result.info;
                    if(result.result){
                        console.log(result);
                        $('#deleteProductS').removeClass('hide').addClass('in');
                        setTimeout(function(){$('#deleteProductS').removeClass('in').addClass('hide');$('#deleteProductModal').modal('toggle');},1500);
                    }else {
                        $('#deleteProductF').removeClass('hide').addClass('in');
                        setTimeout(function(){$('#deleteProductF').removeClass('in').addClass('hide')},3000);
                    }
                })
            }
        },
    })
</script>

</html>