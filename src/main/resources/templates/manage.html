
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OFFICE 云物品</title>

    <link rel="stylesheet" href="my/bootstrap.min.css">
    <link rel="stylesheet" href="my/mystyle.css">
    <script src="my/jquery-3.1.1.min.js"></script>
    <script src="my/vue.js"></script>
    <script src="my/bootstrap.min.js"></script>
    <script src="my/axios.min.js"></script>
    <!---<link rel="shortcut icon" href="pic/officeicon.ico">  -->
</head>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="row">
        <div class="col-md-10">
            <p class="navbar-text" style="font-family: Microsoft YaHei;font-size: 18px">OFFICE 云管理</p>
        </div>
        <div id="user" class="col-md-2" style="padding-top: 4.5px">
            <div class="btn-group">
                <img src="pic/user_icon.png" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <p class="navbar-text" style="font-family: Microsoft YaHei;font-size: 15px">{{ user_truename }}</p>
                <ul class="dropdown-menu">
                    <li><img src="pic/user2_icon.png"></li>
                    <li style="color: #8a8a8a">{{ user_truename }}</li>
                    <li style="color: #8a8a8a">{{ user_name }}</li>
                    <li role="separator" class="divider"></li>
                    <li><a data-toggle="modal" data-target="#userInfo">个人详情</a></li>
                    <li><a href="http://localhost:8080/loginout">注销</a></li>
                </ul>
            </div>

        </div>
    </div>
</nav>

<body style="padding-top: 55px;">
<div id="fun_show" class="left-nav">
    <div class="list-group">
        <a href="#" class="list-group-item " v-bind:class="{ 'list-item-active':m_office }">物品分类</a>
        <a href="#" class="list-group-item" v-show="userdata.user_authority >= 3" v-bind:class="{ 'list-item-active':m_officeInfo }">管理物品</a>
        <a href="#" class="list-group-item" v-show="userdata.user_authority >= 7" v-bind:class="{ 'list-item-active':m_userInfo }">用户管理</a>
        <a href="#" class="list-group-item" v-show="userdata.user_authority >= 3" v-bind:class="{ 'list-item-active':m_applyCheck }">申请审核</a>
        <a href="#" class="list-group-item" v-bind:class="{ 'list-item-active':m_applylist }">申请记录</a>
        <a href="#" class="list-group-item" v-bind:class="{ 'list-item-active':m_borrowlist }">借入记录</a>
        <a href="#" class="list-group-item" v-bind:class="{ 'list-item-active':m_returnlist }">归还记录</a>
        <a href="#" class="list-group-item" v-bind:class="{ 'list-item-active':m_usedata }">使用统计</a>

    </div>
</div>

<div class="rigth-nav">
    <div class="container">
        <div class="panel panel-default" id="allUser">
            <div class="panel-heading">
                用户管理
            </div>
            <div class="panel-body" >
                <div class="row">
                    <div class="col-sm-4">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="输入用户邮箱或姓名" v-model="searchUser">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button" @click="searchU">搜索</button>
                            </span>
                        </div>
                    </div>
                    <div class="col-sm-1">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addUserModal">添加用户</button>
                    </div>
                    <!-- 删除用户信息提示框 -->
                    <div class="col-sm-12" >
                        <div class="alert alert-success fade hide" style="text-align: center;margin-bottom: -10px;margin-top: 10px" role="alert" id="deleteInfoS"><strong>删除成功,{{ message.info }}</strong></div>
                        <div class="alert alert-danger fade hide" style="text-align: center;margin-bottom: -10px;margin-top: 10px" role="alert" id="deleteInfoF"><strong>删除失败,{{ message.info }}</strong></div>
                    </div>
                </div>
            </div>

            <table class="table table-hover table-condensed " >
                <thead>
                <tr>
                    <th>序号</th>
                    <th>姓名</th>
                    <th>部门</th>
                    <th>邮箱</th>
                    <th>电话</th>
                    <th>职能</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="user in users">
                    <th scope="row" >{{ user.user_id }}</th>
                    <td>{{ user.user_truename }}</td>
                    <td>{{ user.user_department }}</td>
                    <td>{{ user.user_name }}</td>
                    <td>{{ user.user_phone }}</td>
                    <td v-if="user.user_authority == 7">管理员</td>
                    <td v-else-if="user.user_authority == 3">财务人员</td>
                    <td v-else>普通员工</td>
                    <td>
                        <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#userChangeModal" @click="changeUserInfo(user)">修改</button>
                        <button type="button" class="btn btn-danger btn-sm"  data-toggle="collapse" :data-target="'#'+user.user_id" aria-expanded="false" :aria-controls="user.user_id">删除</button>
                        <!--确认删除collapse-->
                        <div class="collapse" :id="user.user_id" style="width: 270px">
                            <div class="alert alert-warning">
                                确定删除该用户？
                                <button type="button" class="btn btn-default btn-sm" data-toggle="collapse" :data-target="'#'+user.user_id" aria-expanded="false" :aria-controls="user.user_id">取消</button>
                                <button type="button" class="btn btn-default btn-sm" @click="deleteUser(user)">确认</button>
                            </div>
                        </div>
                    </td>
                </tr>

                </tbody>
            </table>



            <div class="panel-footer" style="height: 70px">
                <!--分页导航栏-->
                <nav aria-label="Page navigation" style="text-align: center">
                    <ul class="pagination">
                        <li :class="{ 'disabled': pagination.pageNum==1 }">
                            <a href="#" aria-label="Previous" @click="jumpPage('pre')" >
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li v-for="i in pagination.navigatepageNums" :class="{ 'active': pagination.pageNum==i }"><a href="#" @click="jumpByNumber(i)">{{ i }}</a></li>
                        <li :class="{ 'disabled': pagination.pageNum==pagination.pages }">
                            <a href="#" aria-label="Next" @click="jumpPage('next')">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>


        </div>
    </div>
</div>

<!-- 个人信息Modal框   用户个人信息查看和修改-->
<div th:include="modal :: userModal"></div>

<!-- 添加用户用modal框 -->
<div th:include="modal :: addUserModal"></div>

<!-- 用户信息修改用modal框 -->
<div th:include="modal :: userChangeModal"></div>

</body>
<script src="my/manage_userInfo.js"></script>
<script>
    $('.list-group-item').click(function () {
        $(this).siblings('.list-group-item').removeClass('list-item-active');
        $(this).addClass('list-item-active');
    });


    /* 修改用户信息modal框 */
    var m_userChangeModal = new Vue({
        el:'#userChangeModal',
        data:{
            tempUserInfo,
            message,
        },
        methods:{
            changeUser:function () {
                var self = this;
                var url = 'http://localhost:8080/update/'+self.tempUserInfo.user_name;
                axios.put(url,self.tempUserInfo).then(function(response){
                    var result = response.data;
                    self.message.info = result.info;
                    if(result.result){
                        $('#changeUserS').removeClass('hide').addClass('in');
                        setTimeout(function(){$('#changeUserS').removeClass('in').addClass('hide');$('#userChangeModal').modal('toggle');location.reload();},1500);
                    }else {
                        $('#changeUserF').removeClass('hide').addClass('in')
                        setTimeout(function(){$('#changeUserF').removeClass('in').addClass('hide')},3000);
                    }
                })
            }
        }

    });

    /* 增加用户modal框 */
    var m_userAddModal = new Vue({
        el:'#addUserModal',
        data:{
            addUser:{
                user_name:'',
                user_password:'',
                user_truename:'',
                user_phone:'',
                user_department:'',
                user_authority:1,
            },
            message,
        },
        methods:{
            addNewUser:function () {
                var url = "http://localhost:8080/adduser";
                var self = this;
                axios.post(url,self.addUser).then(function(response){
                    var result = response.data;
                    self.message.info = result.info;
                    if(result.result){
                        self.clearInput();
                        self.isInputEmpty();
                        $('#addUserS').removeClass('hide').addClass('in');
                        setTimeout(function(){$('#addUserS').removeClass('in').addClass('hide');$('#addUserModal').modal('toggle');location.reload();},1000);
                    }else {
                        $('#addUserS').removeClass('hide').addClass('in')
                        setTimeout(function(){$('#addUserF').removeClass('in').addClass('hide')},3000);
                    }
                })

            },
            clearInput:function(){
                var self = this;
                self.addUser.user_name = '';
                self.addUser.user_password = '';
                self.addUser.user_department = '';
                self.addUser.user_phone = '';
                self.addUser.user_truename = '';
                self.addUser.user_authority = 1;
                $("#add").attr("disabled","disabled");
                $("#add").attr("title","请填写完带*的项");
            },
            isInputEmpty:function () {
                var self = this;
                if( self.addUser.user_name != '' && self.addUser.user_password != '' && self.addUser.user_truename != '' && self.addUser.user_department != '' && self.addUser.user_authority != '' ){
                    $("#add").removeAttr("title","请填写完带*的项");
                    $("#add").removeAttr("disabled","disabled");
                }else {
                    $("#add").attr("disabled","disabled");
                    $("#add").attr("title","请填写完带*的项");

                }
            },
        }

    })
    


</script>

</html>